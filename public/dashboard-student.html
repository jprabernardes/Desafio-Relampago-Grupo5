<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Aluno</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 250px;
      background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem 1rem;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 3rem;
    }

    .nav-item {
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .nav-item.active {
      background: rgba(255, 255, 255, 0.2);
    }

    .logout-btn {
      margin-top: auto;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      margin-top: 2rem;
    }

    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 2rem;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .header h1 {
      font-size: 2rem;
      color: #333;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
    }

    /* Section */
    .section {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
      display: none;
    }

    .section.active {
      display: block;
    }

    .section h2 {
      margin-bottom: 1.5rem;
      color: #333;
    }

    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .btn-success {
      background: #28a745;
      color: white;
    }

    .btn-success:hover {
      background: #218838;
    }

    /* Alert */
    .alert {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: none;
    }

    .alert.show {
      display: block;
    }

    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    /* Workout Card */
    .workout-card {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      border-left: 4px solid #667eea;
    }

    .workout-card h3 {
      margin-bottom: 0.5rem;
      color: #333;
    }

    .workout-card pre {
      white-space: pre-wrap;
      font-family: inherit;
      color: #666;
      margin-top: 1rem;
    }

    .workout-actions {
      margin-top: 1rem;
      display: flex;
      gap: 0.5rem;
    }

    /* Class Card */
    .class-card {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      border-left: 4px solid #28a745;
    }

    .class-card h3 {
      margin-bottom: 0.5rem;
      color: #333;
    }

    .class-card p {
      color: #666;
      margin-bottom: 0.5rem;
    }

    .class-card .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-top: 0.5rem;
    }

    .badge-success {
      background: #d4edda;
      color: #155724;
    }

    .badge-warning {
      background: #fff3cd;
      color: #856404;
    }

    .badge-danger {
      background: #f8d7da;
      color: #721c24;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      width: 90%;
      max-width: 500px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
    }

    .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .class-card-clickable {
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
      border-left: 5px solid #764ba2;
    }

    .class-card-clickable:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      border-left-color: #667eea;
    }

    .class-status {
      font-weight: 700;
      font-size: 0.85rem;
      margin-top: auto;
      padding-top: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Grid Layout for Classes */
    #classesList,
    #myClassesList {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
    }

    .status-enrolled {
      color: #28a745;
    }

    .status-full {
      color: #dc3545;
    }

    .status-available {
      color: #667eea;
    }

    /* Modal Polish */
    .modal-content {
      border-radius: 16px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .modal-header h2 {
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .modal-info-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
      color: #4a5568;
    }

    /* Print styles */
    @media print {
      /* ... */
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">FitManager</div>
      <nav>
        <div class="nav-item active" data-section="workouts">
          üí™ Meus Treinos
        </div>
        <div class="nav-item" data-section="classes">
          üèãÔ∏è Aulas Dispon√≠veis
        </div>
        <div class="nav-item" data-section="my-classes">
          üìÖ Minhas Inscri√ß√µes
        </div>
      </nav>
      <button class="logout-btn" onclick="logout()">üö™ Sair</button>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="header">
        <h1>Dashboard Aluno</h1>
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">A</div>
          <span id="userName">Carregando...</span>
        </div>
      </div>

      <!-- Alert -->
      <div class="alert" id="alert"></div>

      <!-- Workouts Section -->
      <section class="section active" id="workouts">
        <h2>Meus Treinos</h2>
        <div id="workoutsList">
          <p>Carregando...</p>
        </div>
      </section>

      <!-- Available Classes Section -->
      <section class="section" id="classes">
        <h2>Aulas Dispon√≠veis</h2>
        <div id="classesList">
          <p>Carregando...</p>
        </div>
      </section>

      <!-- My Classes Section -->
      <section class="section" id="my-classes">
        <h2>Minhas Inscri√ß√µes</h2>
        <div id="myClassesList">
          <p>Carregando...</p>
        </div>
      </section>
    </main>
  </div>

  <!-- Class Details Modal -->
  <div class="modal" id="classDetailsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalClassTitle">Detalhes da Aula</h2>
      </div>
      <div id="modalClassBody">
        <div class="modal-info-item">
          <span style="font-size: 1.2rem;">üìç</span>
          <span id="modalClassInfo" style="font-weight: 500;"></span>
        </div>
        <div style="margin-top: 1.5rem;">
          <h4 style="color: #2d3748; margin-bottom: 0.5rem;">Descri√ß√£o</h4>
          <p id="modalClassDescription"
            style="color: #718096; line-height: 1.6; font-size: 0.95rem; margin-bottom: 1.5rem;"></p>
        </div>
        <div id="modalClassStatus" style="padding-top: 1rem; border-top: 1px solid #edf2f7; margin-bottom: 1.5rem;">
        </div>
      </div>
      <div class="form-actions" id="modalClassActions">
        <!-- Bot√£o ser√° inserido dinamicamente -->
      </div>
    </div>
  </div>

  <div class="modal" id="confirmModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Confirma√ß√£o</h2>
      </div>
      <p id="confirmMessage" style="margin-bottom: 2rem; color: #666">
        Tem certeza?
      </p>
      <div class="form-actions">
        <button class="btn" onclick="closeConfirmModal()">N√£o</button>
        <button class="btn btn-danger" onclick="confirmAction()">
          Sim, tenho certeza
        </button>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "http://localhost:3000/api";
    // ...

    // L√≥gica do Modal de Confirma√ß√£o
    let pendingConfirmAction = null;

    function showConfirmModal(message, action) {
      document.getElementById("confirmMessage").textContent = message;
      pendingConfirmAction = action;
      document.getElementById("confirmModal").classList.add("active");
    }

    function closeConfirmModal() {
      document.getElementById("confirmModal").classList.remove("active");
      pendingConfirmAction = null;
    }

    function confirmAction() {
      if (pendingConfirmAction) {
        pendingConfirmAction();
      }
      closeConfirmModal();
    }

    // ... (existing code)

    // Cancelar inscri√ß√£o
    async function cancelEnrollment(classId) {
      showConfirmModal(
        "Tem certeza que deseja cancelar sua inscri√ß√£o?",
        async () => {
          console.log("Usu√°rio confirmou cancelamento.");

          try {
            const response = await fetch(
              `${API_URL}/student/classes/${classId}/cancel`,
              {
                method: "DELETE"
              },
            );

            if (!response.ok) {
              const error = await response.json();
              throw new Error(
                error.error || error.message || "Erro ao cancelar inscri√ß√£o",
              );
            }

            showAlert("Inscri√ß√£o cancelada com sucesso!", "success");
            loadAvailableClasses();
            loadMyClasses();
          } catch (error) {
            console.error("Erro:", error);
            showAlert(error.message, "error");
          }
        },
      );
    }

    // Navega√ß√£o
    document.querySelectorAll(".nav-item").forEach((item) => {
      item.addEventListener("click", () => {
        // Remover active de todos
        document
          .querySelectorAll(".nav-item")
          .forEach((i) => i.classList.remove("active"));
        document
          .querySelectorAll(".section")
          .forEach((s) => s.classList.remove("active"));

        // Adicionar active no clicado
        item.classList.add("active");
        const sectionId = item.getAttribute("data-section");
        document.getElementById(sectionId).classList.add("active");

        // Carregar dados se necess√°rio
        if (sectionId === "workouts") loadWorkouts();
        if (sectionId === "classes") loadAvailableClasses();
        if (sectionId === "my-classes") loadMyClasses();
      });
    });

    // Fun√ß√£o para mostrar alerta
    function showAlert(message, type = "success") {
      const alert = document.getElementById("alert");
      alert.textContent = message;
      alert.className = `alert alert-${type} show`;
      setTimeout(() => {
        alert.classList.remove("show");
      }, 10000);
    }

    // Carregar informa√ß√µes do usu√°rio
    async function loadUserInfo() {
      try {
        const response = await fetch(`${API_URL}/auth/me`);

        if (!response.ok) throw new Error("N√£o autorizado");

        const data = await response.json();
        currentUserId = data.id;
        document.getElementById("userName").textContent = data.name || data.nome;
        document.getElementById("userAvatar").textContent = (data.name || data.nome || "A")
          .charAt(0)
          .toUpperCase();

        // Verificar se √© aluno
        if (data.role !== "aluno") {
          showAlert("Acesso negado. Voc√™ n√£o √© aluno.", "error");
          setTimeout(() => logout(), 2000);
        }
      } catch (error) {
        console.error("Erro ao carregar usu√°rio:", error);
        logout();
      }
    }

    // Carregar treinos do aluno
    async function loadWorkouts() {
      try {
        const response = await fetch(`${API_URL}/student/workouts`);

        if (!response.ok) throw new Error("Erro ao carregar treinos");

        const workouts = await response.json();
        const container = document.getElementById("workoutsList");

        if (workouts.length === 0) {
          container.innerHTML =
            "<p>Voc√™ ainda n√£o possui treinos cadastrados. Procure um instrutor!</p>";
          return;
        }

        container.innerHTML = workouts
          .map(
            (workout) => `
            <div class="workout-card">
              <h3>Treino ${workout.name}</h3>
              <p><strong>Instrutor:</strong> ${workout.instructor_name || workout.instructor_id}</p>
              <div class="exercises-list">
                ${Array.isArray(workout.exercises)
                ? workout.exercises
                  .map(
                    (ex) => `
                    <div style="margin-bottom: 4px;">
                      <strong>${ex.name}</strong>: ${ex.series}x${ex.repetitions} - ${ex.weight || ""}
                    </div>
                  `,
                  )
                  .join("")
                : `<pre>${workout.exercises}</pre>`
              }
              </div>
              <div class="workout-actions">
                <button class="btn btn-primary" onclick="printWorkout(${workout.id})">üñ®Ô∏è Imprimir (Check-in)</button>
              </div>
            </div>
          `,
          )
          .join("");
      } catch (error) {
        console.error("Erro:", error);
        showAlert("Erro ao carregar treinos", "error");
      }
    }

    // Imprimir treino (registra check-in)
    async function printWorkout(workoutId) {
      try {
        // Registrar check-in
        const response = await fetch(`${API_URL}/student/checkin`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ workout_id: workoutId }),
        });

        if (!response.ok) {
          const error = await response.json();
          const errorMessage =
            error.error || error.message || "Erro ao registrar check-in";

          // Se o erro for de check-in duplicado, permite imprimir mesmo assim
          if (errorMessage.includes("Voc√™ j√° fez check-in hoje")) {
            showAlert("Voc√™ j√° fez check-in hoje. Imprimindo...", "warning");
          } else {
            throw new Error(errorMessage);
          }
        } else {
          // S√≥ mostra msg de sucesso se retornou 200 OK
          showAlert("Check-in registrado com sucesso!", "success");
        }

        // Imprimir apenas o treino espec√≠fico
        const workoutContent = document
          .querySelector(
            `.workout-card button[onclick="printWorkout(${workoutId})"]`,
          )
          .closest(".workout-card").innerHTML;

        // Remover o bot√£o de impress√£o do conte√∫do a ser impresso
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = workoutContent;
        const btn = tempDiv.querySelector(".workout-actions");
        if (btn) btn.remove();

        const printWindow = window.open("", "", "height=600,width=800");
        printWindow.document.write(
          "<html><head><title>Imprimir Treino</title>",
        );
        printWindow.document.write("<style>");
        printWindow.document.write(
          "body { font-family: sans-serif; padding: 20px; }",
        );
        printWindow.document.write(
          ".workout-card { border: 1px solid #ccc; padding: 20px; border-radius: 8px; }",
        );
        printWindow.document.write("h3 { margin-top: 0; color: #333; }");
        printWindow.document.write("</style>");
        printWindow.document.write("</head><body>");
        printWindow.document.write('<div class="workout-card">');
        printWindow.document.write(tempDiv.innerHTML);
        printWindow.document.write("</div>");
        printWindow.document.write("</body></html>");
        printWindow.document.close();
        printWindow.focus();
        // Pequeno delay para garantir que estilos carreguem
        setTimeout(() => {
          printWindow.print();
          printWindow.close();
        }, 500);
      } catch (error) {
        console.error("Erro:", error);
        showAlert(error.message, "error");
      }
    }

    let allAvailableClasses = [];
    let myEnrollmentIds = [];

    // Carregar aulas dispon√≠veis
    async function loadAvailableClasses() {
      try {
        const [classesRes, myClassesRes] = await Promise.all([
          fetch(`${API_URL}/student/classes`),
          fetch(`${API_URL}/student/my-classes`)
        ]);

        if (!classesRes.ok || !myClassesRes.ok) throw new Error("Erro ao carregar dados das aulas");

        allAvailableClasses = await classesRes.json();
        const myClasses = await myClassesRes.json();
        myEnrollmentIds = myClasses.map(c => c.id);

        renderAvailableClasses();
      } catch (error) {
        console.error("Erro:", error);
        showAlert("Erro ao carregar aulas", "error");
      }
    }

    function renderAvailableClasses() {
      const container = document.getElementById("classesList");
      if (allAvailableClasses.length === 0) {
        container.innerHTML = "<p>Nenhuma aula dispon√≠vel no momento.</p>";
        return;
      }

      container.innerHTML = allAvailableClasses
        .map((cls) => {
          const isInscrito = myEnrollmentIds.includes(cls.id);
          const isFull = cls.current_participants >= cls.max_participants;

          let statusText = "";
          let statusClass = "";

          if (isInscrito) {
            statusText = "Inscrito";
            statusClass = "status-enrolled";
          } else if (isFull) {
            statusText = "Sem vagas";
            statusClass = "status-full";
          } else {
            statusText = `${cls.current_participants || 0} / ${cls.max_participants}`;
            statusClass = "status-available";
          }

          const date = new Date(cls.date);
          const timeStr = date.toLocaleTimeString("pt-BR", { hour: '2-digit', minute: '2-digit' });
          const dateStr = date.toLocaleDateString("pt-BR");

          return `
            <div class="class-card class-card-clickable" onclick="openClassModal(${cls.id})">
              <div>
                <h3 style="margin-bottom: 0.75rem;">${cls.title}</h3>
                <p style="font-size: 0.9rem; margin-bottom: 0.4rem;">üìç ${cls.location || 'Sala Principal'}</p>
                <p style="font-size: 0.9rem;">üìÖ ${dateStr} ‚Ä¢ ‚è∞ ${timeStr}</p>
              </div>
              <span class="class-status ${statusClass}">${statusText}</span>
            </div>
          `;
        })
        .join("");
    }

    // Modal de Detalhes da Aula
    function openClassModal(classId) {
      const cls = allAvailableClasses.find(c => c.id === classId);
      if (!cls) return;

      const isInscrito = myEnrollmentIds.includes(cls.id);
      const isFull = cls.current_participants >= cls.max_participants;
      const date = new Date(cls.date);
      const timeStr = date.toLocaleTimeString("pt-BR", { hour: '2-digit', minute: '2-digit' });
      const dateStr = date.toLocaleDateString("pt-BR");

      document.getElementById("modalClassTitle").textContent = cls.title;
      document.getElementById("modalClassInfo").textContent = `${cls.location || 'Sala Principal'} ‚Ä¢ ${dateStr} √†s ${timeStr}`;
      document.getElementById("modalClassDescription").textContent = cls.description || "Sem descri√ß√£o dispon√≠vel.";

      const statusContainer = document.getElementById("modalClassStatus");
      const actionsContainer = document.getElementById("modalClassActions");

      if (isInscrito) {
        statusContainer.innerHTML = '<span class="class-status status-enrolled">Inscrito</span>';
        actionsContainer.innerHTML = '<button class="btn btn-secondary" onclick="closeClassModal()">Fechar</button>';
      } else if (isFull) {
        statusContainer.innerHTML = '<span class="class-status status-full">Sem vagas</span>';
        actionsContainer.innerHTML = '<button class="btn btn-secondary" onclick="closeClassModal()">Fechar</button>';
      } else {
        statusContainer.innerHTML = `<span class="class-status status-available">Vagas: ${cls.current_participants || 0} / ${cls.max_participants}</span>`;
        actionsContainer.innerHTML = `
          <button class="btn btn-secondary" onclick="closeClassModal()">Cancelar</button>
          <button class="btn btn-success" onclick="enrollFromModal(${cls.id})">Inscrever-se</button>
        `;
      }

      document.getElementById("classDetailsModal").classList.add("active");
    }

    function closeClassModal() {
      document.getElementById("classDetailsModal").classList.remove("active");
    }

    async function enrollFromModal(classId) {
      const btn = document.querySelector("#modalClassActions .btn-success");
      if (btn) {
        btn.disabled = true;
        btn.textContent = "Inscrevendo...";
      }

      try {
        await enrollClass(classId, true);
        // Ap√≥s sucesso, o modal ser√° atualizado ou fechado pela fun√ß√£o enrollClass
      } catch (error) {
        if (btn) {
          btn.disabled = false;
          btn.textContent = "Inscrever-se";
        }
      }
    }

    // Inscrever-se em aula (atualizada para suportar modal)
    async function enrollClass(classId, fromModal = false) {
      try {
        const response = await fetch(
          `${API_URL}/student/classes/${classId}/enroll`,
          {
            method: "POST"
          },
        );

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || error.message || "Erro ao se inscrever");
        }

        showAlert("Inscri√ß√£o realizada com sucesso!", "success");

        // Atualizar dados e UI
        await loadAvailableClasses();
        await loadMyClasses();

        if (fromModal) {
          // Atualizar o modal para mostrar o estado "Inscrito"
          openClassModal(classId);
        }
      } catch (error) {
        console.error("Erro:", error);
        showAlert(error.message, "error");
        throw error;
      }
    }

    // Carregar minhas inscri√ß√µes
    async function loadMyClasses() {
      try {
        const response = await fetch(`${API_URL}/student/my-classes`);

        if (!response.ok) throw new Error("Erro ao carregar inscri√ß√µes");

        const classes = await response.json();
        const container = document.getElementById("myClassesList");

        if (classes.length === 0) {
          container.innerHTML =
            "<p>Voc√™ n√£o est√° inscrito em nenhuma aula.</p>";
          return;
        }

        container.innerHTML = classes
          .map((cls) => {
            const date = new Date(cls.date);
            const isPast = date < new Date();
            const timeStr = date.toLocaleTimeString("pt-BR", { hour: '2-digit', minute: '2-digit' });
            const dateStr = date.toLocaleDateString("pt-BR");

            let statusLabel = isPast
              ? '<span class="class-status status-full">Encerrada</span>'
              : '<span class="class-status status-enrolled">Confirmada</span>';

            let actionBtn = !isPast
              ? `<button class="btn btn-danger btn-sm" style="margin-top: 1.5rem; width: 100%; border-radius: 6px; font-size: 0.85rem;" onclick="cancelEnrollment(${cls.id})">Cancelar Inscri√ß√£o</button>`
              : '';

            return `
            <div class="class-card" style="border-left: 5px solid ${isPast ? '#dc3545' : '#28a745'}; display: flex; flex-direction: column; height: 100%;">
              <div>
                <h3 style="margin-bottom: 0.75rem;">${cls.title}</h3>
                <p style="font-size: 0.9rem; margin-bottom: 0.4rem; color: #4a5568;">üìç ${cls.location || 'Sala Principal'}</p>
                <p style="font-size: 0.9rem; color: #4a5568;">üìÖ ${dateStr} ‚Ä¢ ‚è∞ ${timeStr}</p>
              </div>
              <div style="margin-top: auto; padding-top: 1rem;">
                ${statusLabel}
                ${actionBtn}
              </div>
            </div>
          `;
          })
          .join("");
      } catch (error) {
        console.error("Erro:", error);
        showAlert("Erro ao carregar suas inscri√ß√µes", "error");
      }
    }

    // Cancelar inscri√ß√£o
    // Cancelar inscri√ß√£o
    async function cancelEnrollment(classId) {
      showConfirmModal(
        "Tem certeza que deseja cancelar sua inscri√ß√£o?",
        async () => {
          console.log("Usu√°rio confirmou cancelamento.");

          try {
            const response = await fetch(
              `${API_URL}/student/classes/${classId}/cancel`,
              {
                method: "DELETE"
              },
            );

            if (!response.ok) {
              const error = await response.json();
              throw new Error(
                error.error || error.message || "Erro ao cancelar inscri√ß√£o",
              );
            }

            showAlert("Inscri√ß√£o cancelada com sucesso!", "success");
            loadAvailableClasses();
            loadMyClasses();
          } catch (error) {
            console.error("Erro:", error);
            showAlert(error.message, "error");
          }
        },
      );
    }

    // Logout
    async function logout() {
      await fetch(`${API_URL}/auth/logout`, { method: "DELETE" });
      window.location.href = "/";
    }


    // Inicializar
    loadUserInfo();
    loadWorkouts();
  </script>
</body>

</html>